{"version":3,"sources":["../../src/ts/widgets/component.ts"],"names":[],"mappings":"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","file":"component.js","sourcesContent":["import { AgEvent } from \"../events\";\nimport { Autowired, PostConstruct, PreConstruct } from \"../context/context\";\nimport { AgStackComponentsRegistry } from \"../components/agStackComponentsRegistry\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { _, NumberSequence } from \"../utils\";\n\nconst compIdSequence = new NumberSequence();\n\nexport interface VisibleChangedEvent extends AgEvent {\n    visible: boolean;\n}\n\nexport class Component extends BeanStub {\n\n    public static EVENT_DISPLAYED_CHANGED = 'displayedChanged';\n    private eGui: HTMLElement;\n    private annotatedGuiListeners: any[] = [];\n\n    @Autowired('agStackComponentsRegistry') protected agStackComponentsRegistry: AgStackComponentsRegistry;\n\n    // if false, then CSS class \"ag-hidden\" is applied, which sets \"display: none\"\n    private displayed = true;\n\n    // if false, then CSS class \"ag-invisible\" is applied, which sets \"visibility: hidden\"\n    private visible = true;\n\n    protected parentComponent: Component | undefined;\n\n    // unique id for this row component. this is used for getting a reference to the HTML dom.\n    // we cannot use the RowNode id as this is not unique (due to animation, old rows can be lying\n    // around as we create a new rowComp instance for the same row node).\n    private compId = compIdSequence.next();\n\n    constructor(template?: string) {\n        super();\n\n        if (template) {\n            this.setTemplate(template);\n        }\n    }\n\n    public getCompId(): number {\n        return this.compId;\n    }\n\n    // for registered components only, eg creates AgCheckbox instance from ag-checkbox HTML tag\n    private createChildComponentsFromTags(parentNode: Element, paramsMap?: any): void {\n        // we MUST take a copy of the list first, as the 'swapComponentForNode' adds comments into the DOM\n        // which messes up the traversal order of the children.\n        const childNodeList: Node[] = _.copyNodeList(parentNode.childNodes);\n\n        _.forEach(childNodeList, childNode => {\n            if (!(childNode instanceof HTMLElement)) {\n                return;\n            }\n\n            const childComp = this.createComponentFromElement(childNode, (childComp) => {\n                // copy over all attributes, including css classes, so any attributes user put on the tag\n                // wll be carried across\n                this.copyAttributesFromNode(childNode, childComp.getGui());\n            }, paramsMap);\n\n            if (childComp) {\n                if ((childComp as any).addItems && childNode.children.length) {\n                    this.createChildComponentsFromTags(childNode);\n\n                    // converting from HTMLCollection to Array\n                    const items = Array.prototype.slice.call(childNode.children);\n\n                    (childComp as any).addItems(items);\n                }\n                // replace the tag (eg ag-checkbox) with the proper HTMLElement (eg 'div') in the dom\n                this.swapComponentForNode(childComp, parentNode, childNode);\n            } else if (childNode.childNodes) {\n                this.createChildComponentsFromTags(childNode);\n            }\n        });\n    }\n\n    public createComponentFromElement(element: HTMLElement, afterPreCreateCallback?: (comp: Component) => void, paramsMap?: any): Component {\n        const key = element.nodeName;\n        const componentParams = paramsMap ? paramsMap[element.getAttribute('ref')] : undefined;\n        const ComponentClass = this.agStackComponentsRegistry.getComponentClass(key);\n        if (ComponentClass) {\n            const newComponent = new ComponentClass(componentParams) as Component;\n            this.createBean(newComponent, null, afterPreCreateCallback);\n            return newComponent;\n        }\n        return null;\n    }\n\n    private copyAttributesFromNode(source: Element, dest: Element): void {\n        _.iterateNamedNodeMap(source.attributes, (name, value) => dest.setAttribute(name, value));\n    }\n\n    private swapComponentForNode(newComponent: Component, parentNode: Element, childNode: Node): void {\n        const eComponent = newComponent.getGui();\n        parentNode.replaceChild(eComponent, childNode);\n        parentNode.insertBefore(document.createComment(childNode.nodeName), eComponent);\n        this.addDestroyFunc(this.destroyBean.bind(this, newComponent));\n        this.swapInComponentForQuerySelectors(newComponent, childNode);\n    }\n\n    private swapInComponentForQuerySelectors(newComponent: Component, childNode: Node): void {\n        const thisNoType = this as any;\n\n        this.iterateOverQuerySelectors((querySelector: any) => {\n            if (thisNoType[querySelector.attributeName] === childNode) {\n                thisNoType[querySelector.attributeName] = newComponent;\n            }\n        });\n    }\n\n    private iterateOverQuerySelectors(action: (querySelector: any) => void): void {\n        let thisPrototype: any = Object.getPrototypeOf(this);\n\n        while (thisPrototype != null) {\n            const metaData = thisPrototype.__agComponentMetaData;\n            const currentProtoName = (thisPrototype.constructor).name;\n\n            if (metaData && metaData[currentProtoName] && metaData[currentProtoName].querySelectors) {\n                _.forEach(metaData[currentProtoName].querySelectors, (querySelector: any) => action(querySelector));\n            }\n\n            thisPrototype = Object.getPrototypeOf(thisPrototype);\n        }\n    }\n\n    public setTemplate(template: string, paramsMap?: any): void {\n        const eGui = _.loadTemplate(template as string);\n        this.setTemplateFromElement(eGui, paramsMap);\n    }\n\n    public setTemplateFromElement(element: HTMLElement, paramsMap?: any): void {\n        this.eGui = element;\n        (this.eGui as any).__agComponent = this;\n        this.addAnnotatedGuiEventListeners();\n        this.wireQuerySelectors();\n\n        // context will not be available when user sets template in constructor\n        if (!!this.getContext()) {\n            this.createChildComponentsFromTags(this.getGui(), paramsMap);\n        }\n    }\n\n    @PreConstruct\n    private createChildComponentsPreConstruct(): void {\n        // ui exists if user sets template in constructor. when this happens, we have to wait for the context\n        // to be autoWired first before we can create child components.\n        if (!!this.getGui()) {\n            this.createChildComponentsFromTags(this.getGui());\n        }\n    }\n\n    protected wireQuerySelectors(): void {\n        if (!this.eGui) {\n            return;\n        }\n\n        const thisNoType = this as any;\n\n        this.iterateOverQuerySelectors((querySelector: any) => {\n            const resultOfQuery = this.eGui.querySelector(querySelector.querySelector);\n\n            if (resultOfQuery) {\n                thisNoType[querySelector.attributeName] = (resultOfQuery as any).__agComponent || resultOfQuery;\n            } else {\n                // put debug msg in here if query selector fails???\n            }\n        });\n    }\n\n    private addAnnotatedGuiEventListeners(): void {\n        this.removeAnnotatedGuiEventListeners();\n\n        if (!this.eGui) {\n            return;\n        }\n\n        const listenerMethods = this.getAgComponentMetaData('guiListenerMethods');\n\n        if (!listenerMethods) { return; }\n\n        if (!this.annotatedGuiListeners) {\n            this.annotatedGuiListeners = [];\n        }\n\n        listenerMethods.forEach(meta => {\n            const element = this.getRefElement(meta.ref);\n            if (!element) { return; }\n            const listener = (this as any)[meta.methodName].bind(this);\n            element.addEventListener(meta.eventName, listener);\n            this.annotatedGuiListeners.push({ eventName: meta.eventName, listener, element });\n        });\n    }\n\n    @PostConstruct\n    private addAnnotatedGridEventListeners(): void {\n        const listenerMetas = this.getAgComponentMetaData('gridListenerMethods');\n\n        if (!listenerMetas) { return; }\n\n        listenerMetas.forEach(meta => {\n\n            const listener = (this as any)[meta.methodName].bind(this);\n            this.addManagedListener(this.eventService, meta.eventName, listener);\n        });\n    }\n\n    private getAgComponentMetaData(key: string): any[] {\n        let res: any[] = [];\n\n        let thisProto: any = Object.getPrototypeOf(this);\n\n        while (thisProto != null) {\n            const metaData = thisProto.__agComponentMetaData;\n            let currentProtoName = (thisProto.constructor).name;\n\n            // IE does not support Function.prototype.name, so we need to extract\n            // the name using a RegEx\n            // from: https://matt.scharley.me/2012/03/monkey-patch-name-ie.html\n            if (currentProtoName === undefined) {\n                const funcNameRegex = /function\\s([^(]{1,})\\(/;\n                const results = funcNameRegex.exec(thisProto.constructor.toString());\n\n                if (results && results.length > 1) {\n                    currentProtoName = results[1].trim();\n                }\n            }\n\n            if (metaData && metaData[currentProtoName] && metaData[currentProtoName][key]) {\n                res = res.concat(metaData[currentProtoName][key]);\n            }\n\n            thisProto = Object.getPrototypeOf(thisProto);\n        }\n\n        return res;\n    }\n\n    private removeAnnotatedGuiEventListeners(): void {\n        if (!this.annotatedGuiListeners) {\n            return;\n        }\n\n        _.forEach(this.annotatedGuiListeners, e => {\n            e.element.removeEventListener(e.eventName, e.listener);\n        });\n\n        this.annotatedGuiListeners = [];\n    }\n\n    public getGui(): HTMLElement {\n        return this.eGui;\n    }\n\n    public getFocusableElement(): HTMLElement {\n        return this.eGui;\n    }\n\n    public setParentComponent(component: Component) {\n        this.parentComponent = component;\n    }\n\n    public getParentComponent(): Component | undefined {\n        return this.parentComponent;\n    }\n\n    // this method is for older code, that wants to provide the gui element,\n    // it is not intended for this to be in ag-Stack\n    protected setGui(eGui: HTMLElement): void {\n        this.eGui = eGui;\n    }\n\n    protected queryForHtmlElement(cssSelector: string): HTMLElement {\n        return this.eGui.querySelector(cssSelector) as HTMLElement;\n    }\n\n    protected queryForHtmlInputElement(cssSelector: string): HTMLInputElement {\n        return this.eGui.querySelector(cssSelector) as HTMLInputElement;\n    }\n\n    public appendChild(newChild: HTMLElement | Component, container?: HTMLElement): void {\n        if (!container) {\n            container = this.eGui;\n        }\n\n        if (_.isNodeOrElement(newChild)) {\n            container.appendChild(newChild as HTMLElement);\n        } else {\n            const childComponent = newChild as Component;\n            container.appendChild(childComponent.getGui());\n            this.addDestroyFunc(this.destroyBean.bind(this, childComponent));\n        }\n    }\n\n    public isDisplayed(): boolean {\n        return this.displayed;\n    }\n\n    public setVisible(visible: boolean): void {\n        if (visible !== this.visible) {\n            this.visible = visible;\n\n            _.setVisible(this.eGui, visible);\n        }\n    }\n\n    public setDisplayed(displayed: boolean): void {\n        if (displayed !== this.displayed) {\n            this.displayed = displayed;\n\n            _.setDisplayed(this.eGui, displayed);\n\n            const event: VisibleChangedEvent = {\n                type: Component.EVENT_DISPLAYED_CHANGED,\n                visible: this.displayed\n            };\n\n            this.dispatchEvent(event);\n        }\n    }\n\n    protected destroy(): void {\n        this.removeAnnotatedGuiEventListeners();\n        super.destroy();\n    }\n\n    public addGuiEventListener(event: string, listener: (event: any) => void): void {\n        this.eGui.addEventListener(event, listener);\n        this.addDestroyFunc(() => this.eGui.removeEventListener(event, listener));\n    }\n\n    public addCssClass(className: string): void {\n        _.addCssClass(this.eGui, className);\n    }\n\n    public removeCssClass(className: string): void {\n        _.removeCssClass(this.eGui, className);\n    }\n\n    public addOrRemoveCssClass(className: string, addOrRemove: boolean): void {\n        _.addOrRemoveCssClass(this.eGui, className, addOrRemove);\n    }\n\n    public getAttribute(key: string): string | null {\n        const { eGui } = this;\n        return eGui ? eGui.getAttribute(key) : null;\n    }\n\n    public getRefElement(refName: string): HTMLElement {\n        return this.queryForHtmlElement(`[ref=\"${refName}\"]`);\n    }\n}\n"]}