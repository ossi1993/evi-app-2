{"version":3,"sources":["../../src/ts/environment.ts"],"names":[],"mappings":"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","file":"environment.js","sourcesContent":["import { Bean, Autowired } from './context/context';\nimport { BeanStub } from \"./context/beanStub\";\nimport { _ } from './utils';\n\nexport type SASS_PROPERTIES = 'headerHeight' | 'headerCellMinWidth' | 'listItemHeight' | 'rowHeight' | 'chartMenuPanelWidth';\n\ninterface HardCodedSize {\n    [key: string]: {\n        [key in SASS_PROPERTIES]?: number;\n    };\n}\n\nconst MAT_GRID_SIZE = 8;\nconst BASE_GRID_SIZE = 4;\nconst BALHAM_GRID_SIZE = 4;\nconst ALPINE_GRID_SIZE = 6;\n\nconst HARD_CODED_SIZES: HardCodedSize = {\n    // this item is required for custom themes\n    'ag-theme-custom': {\n        headerHeight: 25,\n        headerCellMinWidth: 24,\n        listItemHeight: BASE_GRID_SIZE * 5,\n        rowHeight: 25,\n        chartMenuPanelWidth: 220\n    },\n    'ag-theme-material': {\n        headerHeight: MAT_GRID_SIZE * 7,\n        headerCellMinWidth: 48,\n        listItemHeight: MAT_GRID_SIZE * 5,\n        rowHeight: MAT_GRID_SIZE * 6,\n        chartMenuPanelWidth: 240\n    },\n    'ag-theme-balham': {\n        headerHeight: BALHAM_GRID_SIZE * 8,\n        headerCellMinWidth: 24,\n        listItemHeight: BALHAM_GRID_SIZE * 7,\n        rowHeight: BALHAM_GRID_SIZE * 7,\n        chartMenuPanelWidth: 220\n    },\n    'ag-theme-alpine': {\n        headerHeight: ALPINE_GRID_SIZE * 8,\n        headerCellMinWidth: 36,\n        listItemHeight: ALPINE_GRID_SIZE * 5,\n        rowHeight: ALPINE_GRID_SIZE * 7,\n        chartMenuPanelWidth: 240\n    }\n};\n\n/**\n * this object contains a list of Sass variables and an array\n * of CSS styles required to get the correct value.\n * eg. $virtual-item-height requires a structure, so we can get its height.\n * <div class=\"ag-theme-balham\">\n *     <div class=\"ag-virtual-list-container\">\n *         <div class=\"ag-virtual-list-item\"></div>\n *     </div>\n * </div>\n */\nconst SASS_PROPERTY_BUILDER: { [key in SASS_PROPERTIES]: string[] } = {\n    headerHeight: ['ag-header-row'],\n    headerCellMinWidth: ['ag-header-cell'],\n    listItemHeight: ['ag-virtual-list-item'],\n    rowHeight: ['ag-row'],\n    chartMenuPanelWidth: ['ag-chart-docked-container']\n};\n\nconst CALCULATED_SIZES: HardCodedSize = {};\n\n@Bean('environment')\nexport class Environment extends BeanStub {\n\n    @Autowired('eGridDiv') private eGridDiv: HTMLElement;\n\n    public getSassVariable(theme: string, key: SASS_PROPERTIES): number {\n        const useTheme = 'ag-theme-' + (theme.match('material') ? 'material' : theme.match('balham') ? 'balham' : theme.match('alpine') ? 'alpine' : 'custom');\n        const defaultValue = HARD_CODED_SIZES[useTheme][key];\n        let calculatedValue = 0;\n\n        if (!CALCULATED_SIZES[theme]) {\n            CALCULATED_SIZES[theme] = {};\n        }\n\n        if (CALCULATED_SIZES[theme][key]) {\n            return CALCULATED_SIZES[theme][key];\n        }\n\n        if (SASS_PROPERTY_BUILDER[key]) {\n            const classList = SASS_PROPERTY_BUILDER[key];\n            const div = document.createElement('div');\n            div.style.position = 'absolute';\n            const el: HTMLDivElement = classList.reduce((el: HTMLDivElement, currentClass: string, idx: number) => {\n                if (idx === 0) {\n                    _.addCssClass(el, theme);\n                }\n\n                const div = document.createElement('div');\n                div.style.position = 'static';\n                _.addCssClass(div, currentClass);\n                el.appendChild(div);\n\n                return div;\n            }, div);\n\n            if (document.body) {\n                document.body.appendChild(div);\n                const sizeName = key.toLowerCase().indexOf('height') !== -1 ? 'height' : 'width';\n                calculatedValue = parseInt(window.getComputedStyle(el)[sizeName], 10);\n                document.body.removeChild(div);\n            }\n        }\n\n        CALCULATED_SIZES[theme][key] = calculatedValue || defaultValue;\n\n        return CALCULATED_SIZES[theme][key];\n    }\n\n    public isThemeDark(): boolean {\n        const { theme } = this.getTheme();\n        return !!theme && theme.indexOf('dark') >= 0;\n    }\n\n    public chartMenuPanelWidth() {\n        const theme = this.getTheme().themeFamily;\n        return this.getSassVariable(theme, 'chartMenuPanelWidth');\n    }\n\n    public getTheme(): { theme?: string, el?: HTMLElement, themeFamily?: string } {\n        const reg = /\\bag-(material|(?:theme-([\\w\\-]*)))\\b/;\n        let el: HTMLElement = this.eGridDiv;\n        let themeMatch: RegExpMatchArray;\n\n        while (el) {\n            themeMatch = reg.exec(el.className);\n            if (!themeMatch) {\n                el = el.parentElement;\n            } else {\n                break;\n            }\n        }\n\n        if (!themeMatch) { return {}; }\n\n        const theme = themeMatch[0];\n        const usingOldTheme = themeMatch[2] === undefined;\n\n        if (usingOldTheme) {\n            const newTheme = theme.replace('ag-', 'ag-theme-');\n            _.doOnce(() => console.warn(`ag-Grid: As of v19 old theme are no longer provided. Please replace ${theme} with ${newTheme}.`), 'using-old-theme');\n        }\n\n        return { theme, el, themeFamily: theme.replace(/-dark$/, '') };\n    }\n}\n"]}