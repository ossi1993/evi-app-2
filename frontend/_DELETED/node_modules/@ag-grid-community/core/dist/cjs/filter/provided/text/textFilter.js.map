{"version":3,"sources":["../../src/ts/filter/provided/text/textFilter.ts"],"names":[],"mappings":"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","file":"textFilter.js","sourcesContent":["import { IDoesFilterPassParams } from '../../../interfaces/iFilter';\nimport { RefSelector } from '../../../widgets/componentAnnotations';\nimport {\n    SimpleFilter,\n    ConditionPosition,\n    ISimpleFilterParams,\n    ISimpleFilterModel\n} from '../simpleFilter';\nimport { AgInputTextField } from '../../../widgets/agInputTextField';\nimport { makeNull } from '../../../utils/generic';\nimport { setDisplayed } from '../../../utils/dom';\nimport { IAfterGuiAttachedParams } from '../../../interfaces/iAfterGuiAttachedParams';\nimport { Promise } from '../../../utils';\nimport { forEach } from '../../../utils/array';\n\nexport interface TextFilterModel extends ISimpleFilterModel {\n    filter?: string;\n}\n\nexport interface TextComparator {\n    (filter: string, gridValue: any, filterText: string): boolean;\n}\n\nexport interface TextFormatter {\n    (from: string): string;\n}\n\nexport interface ITextFilterParams extends ISimpleFilterParams {\n    textCustomComparator?: TextComparator;\n    caseSensitive?: boolean;\n    textFormatter?: (from: string) => string;\n}\n\nexport class TextFilter extends SimpleFilter<TextFilterModel> {\n\n    private static readonly FILTER_TYPE = 'text';\n\n    public static DEFAULT_FILTER_OPTIONS = [\n        SimpleFilter.CONTAINS,\n        SimpleFilter.NOT_CONTAINS,\n        SimpleFilter.EQUALS,\n        SimpleFilter.NOT_EQUAL,\n        SimpleFilter.STARTS_WITH,\n        SimpleFilter.ENDS_WITH\n    ];\n\n    static DEFAULT_FORMATTER: TextFormatter = (from: string) => from;\n\n    static DEFAULT_LOWERCASE_FORMATTER: TextFormatter = (from: string) =>\n        from == null ? null : from.toString().toLowerCase();\n\n    static DEFAULT_COMPARATOR: TextComparator = (filter: string, value: any, filterText: string) => {\n        switch (filter) {\n            case TextFilter.CONTAINS:\n                return value.indexOf(filterText) >= 0;\n            case TextFilter.NOT_CONTAINS:\n                return value.indexOf(filterText) === -1;\n            case TextFilter.EQUALS:\n                return value === filterText;\n            case TextFilter.NOT_EQUAL:\n                return value != filterText;\n            case TextFilter.STARTS_WITH:\n                return value.indexOf(filterText) === 0;\n            case TextFilter.ENDS_WITH:\n                const index = value.lastIndexOf(filterText);\n                return index >= 0 && index === (value.length - filterText.length);\n            default:\n                // should never happen\n                console.warn('invalid filter type ' + filter);\n                return false;\n        }\n    };\n\n    @RefSelector('eValue1') private eValue1: AgInputTextField;\n    @RefSelector('eValue2') private eValue2: AgInputTextField;\n\n    private comparator: TextComparator;\n    private formatter: TextFormatter;\n\n    private textFilterParams: ITextFilterParams;\n\n    protected getDefaultDebounceMs(): number {\n        return 500;\n    }\n\n    private getValue(inputField: AgInputTextField): string {\n        let val = inputField.getValue();\n\n        val = makeNull(val);\n\n        if (val && val.trim() === '') {\n            val = null;\n        }\n\n        return val;\n    }\n\n    private addValueChangedListeners(): void {\n        const listener = () => this.onUiChanged();\n        this.eValue1.onValueChange(listener);\n        this.eValue2.onValueChange(listener);\n    }\n\n    protected setParams(params: ITextFilterParams): void {\n        super.setParams(params);\n\n        this.textFilterParams = params;\n        this.comparator = this.textFilterParams.textCustomComparator || TextFilter.DEFAULT_COMPARATOR;\n        this.formatter = this.textFilterParams.textFormatter ||\n            (this.textFilterParams.caseSensitive == true\n                ? TextFilter.DEFAULT_FORMATTER\n                : TextFilter.DEFAULT_LOWERCASE_FORMATTER);\n\n        this.addValueChangedListeners();\n    }\n\n    protected setConditionIntoUi(model: TextFilterModel, position: ConditionPosition): void {\n        const positionOne = position === ConditionPosition.One;\n        const eValue = positionOne ? this.eValue1 : this.eValue2;\n\n        eValue.setValue(model ? model.filter : null);\n    }\n\n    protected createCondition(position: ConditionPosition): TextFilterModel {\n        const positionOne = position === ConditionPosition.One;\n        const type = positionOne ? this.getCondition1Type() : this.getCondition2Type();\n        const eValue = positionOne ? this.eValue1 : this.eValue2;\n        const value = this.getValue(eValue);\n        const model: TextFilterModel = {\n            filterType: TextFilter.FILTER_TYPE,\n            type: type\n        };\n\n        if (!this.doesFilterHaveHiddenInput(type)) {\n            model.filter = value;\n        }\n\n        return model;\n    }\n\n    protected getFilterType(): string {\n        return TextFilter.FILTER_TYPE;\n    }\n\n    protected areSimpleModelsEqual(aSimple: TextFilterModel, bSimple: TextFilterModel): boolean {\n        return aSimple.filter === bSimple.filter && aSimple.type === bSimple.type;\n    }\n\n    protected resetUiToDefaults(silent?: boolean): Promise<void> {\n        return super.resetUiToDefaults(silent).then(() => {\n            this.forEachInput(field => field.setValue(null, silent));\n            this.resetPlaceholder();\n        });\n    }\n\n    private resetPlaceholder(): void {\n        const placeholder = this.translate('filterOoo');\n\n        this.forEachInput(field => field.setInputPlaceholder(placeholder));\n    }\n\n    private forEachInput(action: (field: AgInputTextField) => void): void {\n        forEach([this.eValue1, this.eValue2], action);\n    }\n\n    protected setValueFromFloatingFilter(value: string): void {\n        this.eValue1.setValue(value);\n        this.eValue2.setValue(null);\n    }\n\n    protected getDefaultFilterOptions(): string[] {\n        return TextFilter.DEFAULT_FILTER_OPTIONS;\n    }\n\n    protected createValueTemplate(position: ConditionPosition): string {\n        const pos = position === ConditionPosition.One ? '1' : '2';\n\n        return /* html */`\n            <div class=\"ag-filter-body\" ref=\"eCondition${pos}Body\" role=\"presentation\">\n                <ag-input-text-field class=\"ag-filter-filter\" ref=\"eValue${pos}\"></ag-input-text-field>\n            </div>`;\n    }\n\n    protected updateUiVisibility(): void {\n        super.updateUiVisibility();\n\n        const showValue1 = this.showValueFrom(this.getCondition1Type());\n        setDisplayed(this.eValue1.getGui(), showValue1);\n\n        const showValue2 = this.showValueFrom(this.getCondition2Type());\n        setDisplayed(this.eValue2.getGui(), showValue2);\n    }\n\n    public afterGuiAttached(params: IAfterGuiAttachedParams) {\n        super.afterGuiAttached(params);\n\n        this.resetPlaceholder();\n        this.eValue1.getInputElement().focus();\n    }\n\n    protected isConditionUiComplete(position: ConditionPosition): boolean {\n        const positionOne = position === ConditionPosition.One;\n        const option = positionOne ? this.getCondition1Type() : this.getCondition2Type();\n\n        if (option === SimpleFilter.EMPTY) { return false; }\n        if (this.doesFilterHaveHiddenInput(option)) { return true; }\n\n        return this.getValue(positionOne ? this.eValue1 : this.eValue2) != null;\n    }\n\n    public individualConditionPasses(params: IDoesFilterPassParams, filterModel: TextFilterModel): boolean {\n        const filterText = filterModel.filter;\n        const filterOption = filterModel.type;\n        const cellValue = this.textFilterParams.valueGetter(params.node);\n        const cellValueFormatted = this.formatter(cellValue);\n        const customFilterOption = this.optionsFactory.getCustomOption(filterOption);\n\n        if (customFilterOption) {\n            // only execute the custom filter if a value exists or a value isn't required, i.e. input is hidden\n            if (filterText != null || customFilterOption.hideFilterInput) {\n                return customFilterOption.test(filterText, cellValueFormatted);\n            }\n        }\n\n        if (cellValue == null) {\n            return filterOption === SimpleFilter.NOT_EQUAL || filterOption === SimpleFilter.NOT_CONTAINS;\n        }\n\n        const filterTextFormatted = this.formatter(filterText);\n\n        return this.comparator(filterOption, cellValueFormatted, filterTextFormatted);\n    }\n}\n"]}