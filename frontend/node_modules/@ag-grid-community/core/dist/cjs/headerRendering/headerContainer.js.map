{"version":3,"sources":["../../src/ts/headerRendering/headerContainer.ts"],"names":[],"mappings":"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","file":"headerContainer.js","sourcesContent":["import { GridOptionsWrapper } from '../gridOptionsWrapper';\nimport { Autowired, PostConstruct, PreDestroy } from '../context/context';\nimport { DropTarget } from '../dragAndDrop/dragAndDropService';\nimport { ColumnController } from '../columnController/columnController';\nimport { Events } from '../events';\nimport { HeaderRowComp, HeaderRowType } from './headerRowComp';\nimport { BodyDropTarget } from './bodyDropTarget';\nimport { ScrollVisibleService } from '../gridPanel/scrollVisibleService';\nimport { Component } from '../widgets/component';\nimport { Constants } from '../constants';\nimport { setFixedWidth, clearElement } from '../utils/dom';\nimport { BeanStub } from \"../context/beanStub\";\nimport { GridPanel } from '../gridPanel/gridPanel';\n\nexport class HeaderContainer extends BeanStub {\n\n    @Autowired('gridOptionsWrapper') private gridOptionsWrapper: GridOptionsWrapper;\n    @Autowired('columnController') private columnController: ColumnController;\n    @Autowired('scrollVisibleService') private scrollVisibleService: ScrollVisibleService;\n\n    private eContainer: HTMLElement;\n    private eViewport: HTMLElement;\n    private headerRowComps: HeaderRowComp[] = [];\n    private pinned: string;\n    private scrollWidth: number;\n    private dropTarget: DropTarget;\n\n    constructor(eContainer: HTMLElement, eViewport: HTMLElement, pinned: string) {\n        super();\n        this.eContainer = eContainer;\n        this.pinned = pinned;\n        this.eViewport = eViewport;\n    }\n\n    public forEachHeaderElement(callback: (renderedHeaderElement: Component) => void): void {\n        this.headerRowComps.forEach(headerRowComp => headerRowComp.forEachHeaderElement(callback));\n    }\n\n    @PostConstruct\n    private init(): void {\n        this.scrollWidth = this.gridOptionsWrapper.getScrollbarWidth();\n\n        // if value changes, then if not pivoting, we at least need to change the label eg from sum() to avg(),\n        // if pivoting, then the columns have changed\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_VALUE_CHANGED, this.onColumnValueChanged.bind(this)),\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_ROW_GROUP_CHANGED, this.onColumnRowGroupChanged.bind(this)),\n        this.addManagedListener(this.eventService, Events.EVENT_GRID_COLUMNS_CHANGED, this.onGridColumnsChanged.bind(this)),\n        this.addManagedListener(this.eventService, Events.EVENT_SCROLL_VISIBILITY_CHANGED, this.onScrollVisibilityChanged.bind(this)),\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_RESIZED, this.onColumnResized.bind(this)),\n        this.addManagedListener(this.eventService, Events.EVENT_DISPLAYED_COLUMNS_CHANGED, this.onDisplayedColumnsChanged.bind(this))\n    }\n\n    // if row group changes, that means we may need to add aggFuncs to the column headers,\n    // if the grid goes from no aggregation (ie no grouping) to grouping\n    private onColumnRowGroupChanged(): void {\n        this.onGridColumnsChanged();\n    }\n\n    // if the agg func of a column changes, then we may need to update the agg func in columns header\n    private onColumnValueChanged(): void {\n        this.onGridColumnsChanged();\n    }\n\n    private onColumnResized(): void {\n        this.setWidthOfPinnedContainer();\n    }\n\n    private onDisplayedColumnsChanged(): void {\n        this.setWidthOfPinnedContainer();\n    }\n\n    private onScrollVisibilityChanged(): void {\n        this.setWidthOfPinnedContainer();\n    }\n\n    private setWidthOfPinnedContainer(): void {\n        const pinningLeft = this.pinned === Constants.PINNED_LEFT;\n        const pinningRight = this.pinned === Constants.PINNED_RIGHT;\n        const controller = this.columnController;\n        const isRtl = this.gridOptionsWrapper.isEnableRtl();\n\n        if (pinningLeft || pinningRight) {\n            // size to fit all columns\n            let width = controller[pinningLeft ? 'getPinnedLeftContainerWidth' : 'getPinnedRightContainerWidth']();\n\n            // if there is a scroll showing (and taking up space, so Windows, and not iOS)\n            // in the body, then we add extra space to keep header aligned with the body,\n            // as body width fits the cols and the scrollbar\n            const addPaddingForScrollbar = this.scrollVisibleService.isVerticalScrollShowing() && ((isRtl && pinningLeft) || (!isRtl && pinningRight));\n\n            if (addPaddingForScrollbar) {\n                width += this.scrollWidth;\n            }\n\n            setFixedWidth(this.eContainer, width);\n        }\n    }\n\n    public getRowComps(): HeaderRowComp[] {\n        return this.headerRowComps;\n    }\n\n    // grid cols have changed - this also means the number of rows in the header can have\n    // changed. so we remove all the old rows and insert new ones for a complete refresh\n    private onGridColumnsChanged() {\n        this.removeAndCreateAllRowComps();\n    }\n\n    private removeAndCreateAllRowComps(): void {\n        this.removeHeaderRowComps();\n        this.createHeaderRowComps();\n    }\n\n    // we expose this for gridOptions.api.refreshHeader() to call\n    public refresh(): void {\n        this.removeAndCreateAllRowComps();\n    }\n\n    public setupDragAndDrop(gridComp: GridPanel): void {\n        const dropContainer = this.eViewport ? this.eViewport : this.eContainer;\n        const bodyDropTarget = new BodyDropTarget(this.pinned, dropContainer);\n        this.createManagedBean(bodyDropTarget);\n        bodyDropTarget.registerGridComp(gridComp);\n    }\n\n    @PreDestroy\n    private removeHeaderRowComps(): void {\n        this.headerRowComps.forEach(headerRowComp => this.destroyBean(headerRowComp) );\n        this.headerRowComps.length = 0;\n\n        clearElement(this.eContainer);\n    }\n\n    private createHeaderRowComps(): void {\n        // if we are displaying header groups, then we have many rows here.\n        // go through each row of the header, one by one.\n        const rowCount = this.columnController.getHeaderRowCount();\n\n        for (let dept = 0; dept < rowCount; dept++) {\n            const groupRow = dept !== (rowCount - 1);\n            const type = groupRow ? HeaderRowType.COLUMN_GROUP : HeaderRowType.COLUMN;\n            const headerRowComp = new HeaderRowComp(dept, type, this.pinned, this.dropTarget);\n            this.createBean(headerRowComp);\n            this.headerRowComps.push(headerRowComp);\n            headerRowComp.setRowIndex(this.headerRowComps.length - 1);\n            this.eContainer.appendChild(headerRowComp.getGui());\n        }\n\n        if (!this.columnController.isPivotMode() && this.columnController.hasFloatingFilters()) {\n            const headerRowComp = new HeaderRowComp(rowCount, HeaderRowType.FLOATING_FILTER, this.pinned, this.dropTarget);\n            this.createBean(headerRowComp);\n            this.headerRowComps.push(headerRowComp);\n            headerRowComp.setRowIndex(this.headerRowComps.length - 1);\n            this.eContainer.appendChild(headerRowComp.getGui());\n        }\n    }\n}\n"]}