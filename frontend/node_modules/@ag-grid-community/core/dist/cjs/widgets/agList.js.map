{"version":3,"sources":["../../src/ts/widgets/agList.ts"],"names":[],"mappings":"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","file":"agList.js","sourcesContent":["import { AgAbstractField } from \"./agAbstractField\";\nimport { Component } from \"./component\";\nimport { PostConstruct } from \"../context/context\";\nimport { Constants } from \"../constants\";\nimport { _ } from \"../utils\";\n\nexport interface ListOption {\n    value: string;\n    text?: string;\n}\n\nexport class AgList extends Component {\n\n    private options: ListOption[] = [];\n    private itemEls: HTMLElement[] = [];\n    private highlightedEl: HTMLElement;\n    private value: string | null;\n    private displayValue: string | null;\n    public static EVENT_ITEM_SELECTED = 'selectedItem';\n\n    constructor(private cssIdentifier = 'default') {\n        super(AgList.getTemplate(cssIdentifier));\n    }\n\n    @PostConstruct\n    private init(): void {\n        this.addManagedListener(this.getGui(), 'keydown', this.handleKeyDown.bind(this));\n    }\n\n    private static getTemplate(cssIdentifier: string) {\n        return `<div class=\"ag-list ag-${cssIdentifier}-list\"></div>`;\n    }\n\n    private handleKeyDown(e: KeyboardEvent): void {\n        const key = e.keyCode;\n        switch (key) {\n            case Constants.KEY_ENTER:\n                if (!this.highlightedEl) {\n                    this.setValue(this.getValue());\n                } else {\n                    const pos = this.itemEls.indexOf(this.highlightedEl);\n                    this.setValueByIndex(pos);\n                }\n                break;\n            case Constants.KEY_DOWN:\n            case Constants.KEY_UP:\n                const isDown = key === Constants.KEY_DOWN;\n                let itemToHighlight: HTMLElement;\n\n                e.preventDefault();\n\n                if (!this.highlightedEl) {\n                    itemToHighlight = this.itemEls[isDown ? 0 : this.itemEls.length - 1];\n                } else {\n                    const currentIdx = this.itemEls.indexOf(this.highlightedEl);\n                    let nextPos = currentIdx + (isDown ? 1 : -1);\n                    nextPos = Math.min(Math.max(nextPos, 0), this.itemEls.length - 1);\n                    itemToHighlight = this.itemEls[nextPos];\n                }\n                this.highlightItem(itemToHighlight);\n                break;\n        }\n    }\n\n    public addOptions(listOptions: ListOption[]): this {\n        listOptions.forEach(listOption => this.addOption(listOption));\n        return this;\n    }\n\n    public addOption(listOption: ListOption): this {\n        const { value, text } = listOption;\n        const sanitisedText = _.escape(text === undefined ? value : text);\n\n        this.options.push({ value, text: sanitisedText });\n        this.renderOption(sanitisedText);\n\n        return this;\n    }\n\n    private renderOption(innerText: string): void {\n        const itemEl = document.createElement('div');\n        const itemContentEl = document.createElement('span');\n\n        _.addCssClass(itemEl, 'ag-list-item');\n        _.addCssClass(itemEl, `ag-${this.cssIdentifier}-list-item`);\n\n        itemEl.tabIndex = -1;\n        itemContentEl.innerHTML = innerText;\n        this.itemEls.push(itemEl);\n\n        this.addManagedListener(itemEl, 'mouseover', (e: MouseEvent) => this.highlightItem(itemEl));\n        this.addManagedListener(itemEl, 'mouseleave', () => this.clearHighlighted());\n        this.addManagedListener(itemEl, 'click', () => {\n            const idx = this.itemEls.indexOf(itemEl);\n            this.setValueByIndex(idx);\n        });\n\n        itemEl.appendChild(itemContentEl);\n        this.getGui().appendChild(itemEl);\n    }\n\n    public setValue(value?: string, silent?: boolean): this {\n        if (this.value === value) {\n            this.fireItemSelected();\n            return this;\n        }\n\n        if (value == null) {\n            this.reset();\n            return this;\n        }\n\n        const idx = _.findIndex(this.options, option => option.value === value);\n\n        if (idx !== -1) {\n            const option = this.options[idx];\n\n            this.value = option.value;\n            this.displayValue = option.text != null ? option.text : option.value;\n            this.highlightItem(this.itemEls[idx]);\n\n            if (!silent) {\n                this.fireChangeEvent();\n            }\n        }\n\n        return this;\n    }\n\n    public setValueByIndex(idx: number): this {\n        return this.setValue(this.options[idx].value);\n    }\n\n    public getValue(): string | null {\n        return this.value;\n    }\n\n    public getDisplayValue(): string | null {\n        return this.displayValue;\n    }\n\n    public refreshHighlighted(): void {\n        this.clearHighlighted();\n        const idx = _.findIndex(this.options, option => option.value === this.value);\n\n        if (idx !== -1) {\n            this.highlightItem(this.itemEls[idx]);\n        }\n    }\n\n    private reset(): void {\n        this.value = null;\n        this.displayValue = null;\n        this.clearHighlighted();\n        this.fireChangeEvent();\n    }\n\n    private highlightItem(el: HTMLElement): void {\n        if (!el.offsetParent) { return; }\n        _.radioCssClass(el, 'ag-active-item');\n        this.highlightedEl = el;\n        this.highlightedEl.focus();\n    }\n\n    private clearHighlighted(): void {\n        if (!this.highlightedEl || !this.highlightedEl.offsetParent) { return; }\n        _.removeCssClass(this.highlightedEl, 'ag-active-item');\n        this.highlightedEl = null;\n    }\n\n    private fireChangeEvent(): void {\n        this.dispatchEvent({ type: AgAbstractField.EVENT_CHANGED });\n        this.fireItemSelected();\n    }\n\n    private fireItemSelected(): void {\n        this.dispatchEvent({ type: AgList.EVENT_ITEM_SELECTED });\n    }\n}\n"]}